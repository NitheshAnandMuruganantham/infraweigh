import{r as x,aH as j,l as a,n as e,W as C,K as N,aI as g,aJ as I,aK as F,aL as K,N as V,aM as H,aN as J,aO as Q}from"./index.4c95a279.js";import{b as B,e as P,F as v,c as E,k as L,f as i,T as o,D as T,G as U}from"./index.3fb97640.js";import{c as $,a as s,M as z}from"./index.a03a43f2.js";import{B as h,e as G,T as Y}from"./TextField.a171345c.js";import{S as O}from"./Switch.fbd48d7b.js";import{L as R}from"./LinearProgress.8dbc60f0.js";import{c as X}from"./index.ac0a1a76.js";const Z=()=>{const[c,m]=x.exports.useState(!1),d=()=>{m(!0)},p=()=>{m(!1)},[t,{loading:k}]=j();return a("div",{children:[e(h,{variant:"outlined",sx:{m:1},onClick:d,children:"new client"}),a(B,{fullWidth:!0,open:c,onClose:p,children:[e(P,{children:"New Client"}),e(v,{initialValues:{name:"",address:"",email:"",phone:"",gst_in:"",company_name:"",credit:!1,credit_limit:0,branch:{value:null,label:""}},validationSchema:()=>$().shape({name:s().required("Required"),address:s().required("Required"),email:s().required("Required"),phone:s().required("Required"),company_name:s().required("Required"),credit_limit:s()}),onSubmit:async(n,{setSubmitting:u})=>{u(!0),t({variables:{object:{name:n.name,email:n.email,phone:n.phone,gst_in:n.gst_in,blocked:!1,company_name:n.company_name,company_address:n.address,credit:n.credit,credit_limit:n.credit_limit}}}).catch(()=>{C.error("can not create new client")}).then(l=>{l&&l.data&&C.success("client created successfully"),u(!1),p()})},children:({submitForm:n,isSubmitting:u,setFieldValue:l})=>a(N,{children:[e(E,{children:e(L,{children:a(g,{sx:{display:"flex",flexDirection:"column"},children:[e(i,{component:o,sx:{my:1},name:"name",type:"text",label:"name"}),e(i,{component:o,sx:{my:1},name:"company_name",type:"text",label:"company name"}),e(i,{component:o,sx:{my:1},name:"gst_in",type:"text",label:"gst number"}),a(g,{children:[e(G,{children:"credit facility"}),e(i,{component:O,type:"checkbox",name:"credit"})]}),e(i,{component:o,type:"text",label:"credit limit",name:"credit_limit",sx:{my:1}}),e(i,{component:o,type:"text",label:"address",name:"address",sx:{my:1}}),e(i,{component:o,type:"email",label:"email",name:"email",sx:{my:1}}),e(z,{label:"phone",variant:"outlined",countryCodeEditable:!1,sx:{my:1},defaultCountry:"in",onChange:y=>l("phone",y.toString())}),(u||k)&&e(R,{})]})})}),a(T,{children:[e(h,{onClick:p,children:"Cancel"}),e(h,{onClick:()=>{n()},children:"Add"})]})]})})]})]})},ee=({id:c})=>{var u,l,y,w,b,q,_,S;const[m,d]=x.exports.useState(!1),[p,{data:t}]=I({variables:{customerByPkId:c}}),k=async()=>{await p(),d(!0)},n=()=>{d(!1)};return a(N,{children:[e(h,{variant:"contained",color:"secondary",size:"small",onClick:k,children:"Edit"}),a(B,{fullWidth:!0,open:m,onClose:n,children:[e(P,{children:"Edit user"}),e(v,{initialValues:{name:(u=t==null?void 0:t.customer_by_pk)==null?void 0:u.name,address:(l=t==null?void 0:t.customer_by_pk)==null?void 0:l.company_address,email:(y=t==null?void 0:t.customer_by_pk)==null?void 0:y.email,phone:(w=t==null?void 0:t.customer_by_pk)==null?void 0:w.phone,gst_in:(b=t==null?void 0:t.customer_by_pk)==null?void 0:b.gst_in,company_name:(q=t==null?void 0:t.customer_by_pk)==null?void 0:q.company_name,credit:(_=t==null?void 0:t.customer_by_pk)==null?void 0:_.credit,credit_limit:(S=t==null?void 0:t.customer_by_pk)==null?void 0:S.credit_limit},validationSchema:()=>$().shape({name:s().required("Required"),address:s().required("Required"),email:s().required("Required"),phone:s().required("Required"),company_name:s().required("Required"),credit_limit:s()}),onSubmit:async(r,{setSubmitting:f})=>{f(!0),await F.mutate({mutation:K,variables:{pkColumns:{id:c},set:{name:r.name,email:r.email,phone:r.phone,gst_in:r.gst_in,blocked:!1,company_name:r.company_name,company_address:r.address,credit:r.credit,credit_limit:r.credit_limit}}}).catch(()=>{C.error("can not update client")}).then(D=>{D&&C.success("client updated")}),f(!1),n()},children:({submitForm:r,isSubmitting:f,setFieldValue:D,values:M})=>a(N,{children:[e(E,{children:e(L,{children:a(g,{sx:{display:"flex",flexDirection:"column"},children:[e(i,{component:o,sx:{my:1},name:"name",type:"text",label:"name"}),e(i,{component:o,sx:{my:1},name:"company_name",type:"text",label:"company name"}),e(i,{component:o,sx:{my:1},name:"gst_in",type:"text",label:"gst number"}),a(g,{children:[e(G,{children:"credit facility"}),e(i,{component:O,type:"checkbox",name:"credit"})]}),e(i,{component:o,type:"text",label:"credit limit",name:"credit_limit",sx:{my:1}}),e(i,{component:o,type:"text",label:"address",name:"address",sx:{my:1}}),e(i,{component:o,type:"email",label:"email",name:"email",sx:{my:1}}),e(z,{label:"phone",variant:"outlined",value:M.phone,countryCodeEditable:!1,sx:{my:1},defaultCountry:"in",onChange:W=>D("phone",W.toString())}),f&&e(R,{})]})})}),a(T,{children:[e(h,{onClick:n,children:"Cancel"}),e(h,{onClick:()=>{r()},children:"save"})]})]})})]})]})},A=[{field:"name",headerName:"name",width:300,editable:!1,filterable:!1,sortable:!0},{field:"company_address",headerName:"Address",sortable:!0,filterable:!1,width:400},{field:"phone",headerName:"phone",sortable:!0,width:150,filterable:!1},{field:"email",headerName:"e-mail id",sortable:!0,filterable:!1,width:150}],te=[{field:"edit",headerName:"Edit",width:75,sortable:!1,filterable:!1,renderCell:c=>e(ee,{id:c.row.id})},{field:"delete",headerName:"Delete",width:75,sortable:!1,filterable:!1,renderCell:c=>e(h,{variant:"contained",color:"error",size:"small",onClick:()=>{X({title:"Confirm to Delete",message:"Are you sure want to delete this.",buttons:[{label:"Yes",onClick:()=>{F.mutate({mutation:Q,variables:{deleteCustomerByPkId:c.row.id}}).catch(()=>{C.error("bills are linked to this client")}).then(m=>{m&&m.data&&C.success("client deleted successfully")})}},{label:"No",onClick:()=>null}]})},children:"Delete"})}],ce=()=>{var r;const[c,m]=V(),[d,p]=x.exports.useState(""),[t,k]=x.exports.useState(1),[n,u]=x.exports.useState([]),[l,y]=x.exports.useState(1),w=[{name:{_like:`%${d}%`}},{phone:{_like:`%${d}%`}},{email:{_like:`%${d}%`}},{company_name:{_like:`%${d}%`}}],{data:b,loading:q}=H({variables:{orderBy:n,where:{_or:w},offset:(t-1)*l<0?0:(t-1)*l,limit:l}}),{data:_,loading:S}=J({variables:{orderBy:n,where:{_or:w}}});return a(g,{children:[e(Z,{}),e(Y,{fullWidth:!0,onChange:f=>{p(f.target.value)},sx:{width:"90%",my:2},name:"search",label:"Search"}),a(g,{height:500,width:"100%",textAlign:"center",children:[e(R,{sx:{visibility:S||q?"visible":"hidden"}}),e(U,{data:(b==null?void 0:b.customer)||[],pageSize:l,setPageSize:y,setFilter:()=>null,setPage:k,setSort:u,loading:q||S||m,rowCount:((r=_==null?void 0:_.customer_aggregate.aggregate)==null?void 0:r.count)||0,columns:c==="terminal"?A:[...A,...te]})]})]})};export{ce as default};
